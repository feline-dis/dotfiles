#!/bin/zsh

# =============================================================================
# ENVIRONMENT VARIABLES
# =============================================================================

# Oh My Zsh configuration
export ZSH="$HOME/.oh-my-zsh"
export ZSH_THEME="random"

# Language and locale
export LANG="en_US.UTF-8"

# Editor preferences
export EDITOR="nvim"
export VISUAL="nvim"

# Node.js and package managers
export NVM_DIR="$HOME/.nvm"
export PNPM_HOME="$HOME/.local/share/pnpm"

# =============================================================================
# PATH CONFIGURATION
# =============================================================================

# Add custom paths
path+=(
    "$HOME/Downloads/nvim-linux64/bin"
    "$HOME/.local/bin"
    "$HOME/Downloads/Discord"
    "/usr/local/go/bin"
)

# PNPM path handling
case ":$PATH:" in
    *":$PNPM_HOME:"*) ;;
    *) export PATH="$PNPM_HOME:$PATH" ;;
esac

# Function path for custom zsh functions
fpath+="${ZDOTDIR:-~}/.zsh_functions"

# =============================================================================
# OH-MY-ZSH CONFIGURATION
# =============================================================================

# Oh My Zsh settings (commented options available for customization)
# CASE_SENSITIVE="true"
# HYPHEN_INSENSITIVE="true"
# DISABLE_MAGIC_FUNCTIONS="true"
# DISABLE_LS_COLORS="true"
# DISABLE_AUTO_TITLE="true"
# ENABLE_CORRECTION="true"
COMPLETION_WAITING_DOTS="true"
# DISABLE_UNTRACKED_FILES_DIRTY="true"
# HIST_STAMPS="mm/dd/yyyy"

# Update behavior
# zstyle ':omz:update' mode disabled
# zstyle ':omz:update' mode auto
# zstyle ':omz:update' mode reminder
# zstyle ':omz:update' frequency 13

# Plugins
plugins=(
    git
    z
    zsh-autosuggestions    # Suggested addition
    zsh-syntax-highlighting # Suggested addition
)

# Source Oh My Zsh
source "$ZSH/oh-my-zsh.sh"

# =============================================================================
# ALIASES - SYSTEM & NAVIGATION
# =============================================================================

# Basic system commands
alias c="clear"
alias ls="ls -a --color=auto"
alias ll="ls -la --color=auto"
alias mkdir="mkdir -pv"
alias update="sudo apt update && sudo apt upgrade -y"

# Navigation shortcuts
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../../"
alias .4="cd ../../../../"
alias .5="cd ../../../../.."

# Common typos
alias sl="ls"
alias s="ls"

# =============================================================================
# ALIASES - DEVELOPMENT
# =============================================================================

# Editor shortcuts
alias v="nvim ."
alias vim="nvim"
alias nvc="nvim ~/.config/nvim"
alias tmc="nvim ~/config/tmux"
alias zc="nvim ~/.zshrc"
alias zl="source ~/.zshrc"

# =============================================================================
# ALIASES - UTILITIES
# =============================================================================

# Search utilities
alias grep="grep --color=auto"
alias fgrep="fgrep --color=auto"
alias egrep="egrep --color=auto"

# Process monitoring
alias psmem="ps auxf | sort -nr -k 4"
alias psmem10="ps auxf | sort -nr -k 4 | head -10"
alias pscpu="ps auxf | sort -nr -k 3"
alias pscpu10="ps auxf | sort -nr -k 3 | head -10"

# System utilities
alias chbg="~/.fehbg"

# =============================================================================
# FUNCTIONS
# =============================================================================

# Create directory and cd into it
mkcd() {
    mkdir -p "$1" && cd "$1"
}

# GitHub PR creation
ghpr() {
    gh pr create -f -B "$1"
}

# Quick file search
ff() {
    find . -type f -name "*$1*" 2>/dev/null
}

# Quick directory search
fd() {
    find . -type d -name "*$1*" 2>/dev/null
}

# Extract various archive formats
extract() {
    if [ -f "$1" ]; then
        case "$1" in
            *.tar.bz2)   tar xjf "$1"   ;;
            *.tar.gz)    tar xzf "$1"   ;;
            *.bz2)       bunzip2 "$1"   ;;
            *.rar)       unrar x "$1"   ;;
            *.gz)        gunzip "$1"    ;;
            *.tar)       tar xf "$1"    ;;
            *.tbz2)      tar xjf "$1"   ;;
            *.tgz)       tar xzf "$1"   ;;
            *.zip)       unzip "$1"     ;;
            *.Z)         uncompress "$1";;
            *.7z)        7z x "$1"      ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# =============================================================================
# EXTERNAL TOOL INITIALIZATION
# =============================================================================

# NVM initialization
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# =============================================================================
# ADDITIONAL SUGGESTIONS
# =============================================================================

# History configuration
export HISTSIZE=10000
export SAVEHIST=10000
export HISTFILE="$HOME/.zsh_history"
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS
setopt HIST_REDUCE_BLANKS
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY

# Completion improvements
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"

# Key bindings
bindkey '^R' history-incremental-search-backward
bindkey '^[[A' history-beginning-search-backward
bindkey '^[[B' history-beginning-search-forward

# =============================================================================
# PRIVATE CONFIGURATION
# =============================================================================
[ -f ~/.zsh_private ] && source ~/.zsh_private
